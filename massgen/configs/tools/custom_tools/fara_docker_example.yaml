# MassGen Configuration: FARA Computer Use (Docker/Linux Desktop)
#
# This configuration uses Microsoft's FARA-7B (Florence Agent for Rich Automation)
# vision-language model for Linux desktop automation via Docker with X11 virtual display.
#
# Model: FARA-7B
# Provider: Microsoft via Azure Machine Learning
# Based on: Florence foundation model
#
# Azure ML Endpoint Configuration:
# Set FARA_AZURE_ENDPOINT and FARA_AZURE_API_KEY in your .env file
# Authentication: Bearer token
#
# Usage:
#   massgen --config fara_docker_example.yaml "Open Firefox and navigate to wikipedia.org"
#
# Prerequisites:
#   1. Docker container with X11 running (see setup below)
#   2. FARA_AZURE_API_KEY and FARA_AZURE_ENDPOINT in .env
#   3. Optional: VNC for real-time visualization

# Agent Configuration
agents:
  - id: "fara_docker_agent"
    backend:
      type: "openai"  # Use simple backend for orchestration
      model: "gpt-4.1"
      custom_tools:
        - name: ["fara_computer_use"]
          category: "automation"
          path: "massgen/tool/_fara_computer_use/fara_computer_use_tool.py"
          function: ["fara_computer_use"]
          description: >
            Automate Linux desktop tasks using Microsoft's FARA-7B (Florence Agent for Rich
            Automation) vision-language model in a Docker container with X11. Analyzes screenshots,
            provides reasoning, and generates actions via xdotool. Supports clicking, typing,
            keyboard shortcuts, scrolling, dragging.
          preset_args:
            environment: "linux"
            display_width: 1280
            display_height: 800
            max_iterations: 30
            model: "fara-7b"
            # azure_ml_endpoint loaded from FARA_AZURE_ENDPOINT env var
            environment_config:
              container_name: "cua-container"
              display: ":99"
    
    system_message: |
      You are an AI assistant with access to Microsoft's FARA-7B (Florence Agent for Rich
      Automation) vision-language model for Linux desktop automation via Docker.

      You have the fara_computer_use tool which allows you to automate desktop tasks in
      a Docker container with X11 virtual display.

      When users ask you to open applications, navigate the desktop, or interact with GUI
      elements, use the fara_computer_use tool with a clear task description.

      Example: fara_computer_use("Open Firefox and navigate to wikipedia.org")

      The tool will complete the task in the Docker container and return results with
      reasoning for each step. If VNC is enabled, you can watch the automation in real-time.

display:
  type: "rich_terminal"

# Setup Instructions:
# ====================
#
# 1. Add to your .env file in MassGen root directory:
#    FARA_AZURE_API_KEY=your-azure-ml-api-key
#    FARA_AZURE_ENDPOINT=https://your-endpoint.inference.ml.azure.com/score
#
# 2. Install required dependencies:
#    pip install docker python-dotenv
#
# 3. Optional - Install httpx for async HTTP:
#    pip install httpx
#
# 4. Create Docker container with X11:
#    cd MassGen/scripts
#    ./setup_docker_cua.sh
#
#    This creates 'cua-container' with:
#    - Ubuntu 22.04 with Xfce desktop
#    - X11 virtual display on :99 (1280x800)
#    - xdotool for GUI control
#    - Firefox, Chromium browsers
#    - scrot for screenshots
#
# 5. Verify container is running:
#    docker ps | grep cua-container
#
# 6. Optional - Enable VNC for real-time visualization:
#    cd MassGen/scripts
#    ./enable_vnc_viewer.sh
#    vncviewer localhost:5900
#    # Or use any VNC client to connect to localhost:5900
#
# 7. Get your Azure ML API key:
#    - Go to Azure ML Studio
#    - Navigate to your deployed FARA-7B endpoint
#    - Copy the API key from the "Consume" tab
#    - Add to .env file

# Example Usage:
# ==============
#
# Open Firefox:
#   massgen --config fara_docker_example.yaml "Open Firefox and navigate to wikipedia.org"
#
# Text editor:
#   massgen --config fara_docker_example.yaml "Open a text editor and write 'Hello World'"
#
# File manager:
#   massgen --config fara_docker_example.yaml "Open the file manager and create a new folder named 'test'"
#
# Screenshot:
#   massgen --config fara_docker_example.yaml "Take a screenshot using the screenshot tool"
#
# Multi-app workflow:
#   massgen --config fara_docker_example.yaml "Open Firefox, go to GitHub, then take a screenshot"
#
# Keyboard shortcuts:
#   massgen --config fara_docker_example.yaml "Open Firefox and use Ctrl+L to focus the address bar"

# Docker Container Management:
# ============================
#
# Start container:
#   docker start cua-container
#
# Stop container:
#   docker stop cua-container
#
# Check X11 display:
#   docker exec cua-container bash -c "DISPLAY=:99 xdpyinfo | grep dimensions"
#
# Access container shell:
#   docker exec -it cua-container bash

# VNC Visualization:
# ==================
# Watch the automation in real-time:
# 1. Start VNC server:
#    docker exec -d cua-container bash -c "x11vnc -display :99 -forever -shared -rfbport 5900 -nopw"
#
# 2. Connect with VNC viewer:
#    vncviewer localhost:5900

# Cost Information:
# =================
# - Azure ML Endpoint: Pay-per-request pricing (varies by compute)
# - Per task: Depends on number of iterations and compute SKU
# - Docker container: Free (runs locally)
# - See Azure ML pricing for current rates

# Available Actions:
# ==================
# - click(x, y): Left-click at coordinates
# - double_click(x, y): Double-click at coordinates
# - right_click(x, y): Right-click at coordinates
# - type(text): Type text
# - key(key): Press keyboard key
# - scroll(direction, amount): Scroll in direction
# - drag(start_x, start_y, end_x, end_y): Drag operation
# - wait(seconds): Wait for duration
# - done(result): Mark task complete
# - fail(reason): Mark task failed

# Troubleshooting:
# ================
#
# Container not found:
#   cd MassGen/scripts && ./setup_docker_cua.sh
#
# Screenshot fails:
#   docker exec cua-container ps aux | grep Xvfb
#
# VNC connection refused:
#   docker exec -d cua-container bash -c "x11vnc -display :99 -forever -shared -rfbport 5900 -nopw"
#
# Azure ML endpoint errors:
#   - Check API key is correct
#   - Verify endpoint URL ends with /score
#   - Ensure endpoint is deployed and running
